<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>SF Product Labs</title>
    <script>
        /*!
         * JavaScript Cookie v2.2.0
         * https://github.com/js-cookie/js-cookie
         *
         * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
         * Released under the MIT license
         */
        ;
        (function (factory) {
            var registeredInModuleLoader;
            if (typeof define === 'function' && define.amd) {
                define(factory);
                registeredInModuleLoader = true;
            }
            if (typeof exports === 'object') {
                module.exports = factory();
                registeredInModuleLoader = true;
            }
            if (!registeredInModuleLoader) {
                var OldCookies = window.Cookies;
                var api = window.Cookies = factory();
                api.noConflict = function () {
                    window.Cookies = OldCookies;
                    return api;
                };
            }
        }(function () {
            function extend() {
                var i = 0;
                var result = {};
                for (; i < arguments.length; i++) {
                    var attributes = arguments[i];
                    for (var key in attributes) {
                        result[key] = attributes[key];
                    }
                }
                return result;
            }

            function decode(s) {
                return s.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent);
            }

            function init(converter) {
                function api() { }

                function set(key, value, attributes) {
                    if (typeof document === 'undefined') {
                        return;
                    }

                    attributes = extend({
                        path: '/'
                    }, api.defaults, attributes);

                    if (typeof attributes.expires === 'number') {
                        attributes.expires = new Date(new Date() * 1 + attributes.expires * 864e+5);
                    }

                    // We're using "expires" because "max-age" is not supported by IE
                    attributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';

                    try {
                        var result = JSON.stringify(value);
                        if (/^[\{\[]/.test(result)) {
                            value = result;
                        }
                    } catch (e) { }

                    value = converter.write ?
                        converter.write(value, key) :
                        encodeURIComponent(String(value))
                            .replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);

                    key = encodeURIComponent(String(key))
                        .replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent)
                        .replace(/[\(\)]/g, escape);

                    var stringifiedAttributes = '';
                    for (var attributeName in attributes) {
                        if (!attributes[attributeName]) {
                            continue;
                        }
                        stringifiedAttributes += '; ' + attributeName;
                        if (attributes[attributeName] === true) {
                            continue;
                        }

                        // Considers RFC 6265 section 5.2:
                        // ...
                        // 3.  If the remaining unparsed-attributes contains a %x3B (";")
                        //     character:
                        // Consume the characters of the unparsed-attributes up to,
                        // not including, the first %x3B (";") character.
                        // ...
                        stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];
                    }

                    return (document.cookie = key + '=' + value + stringifiedAttributes);
                }

                function get(key, json) {
                    if (typeof document === 'undefined') {
                        return;
                    }

                    var jar = {};
                    // To prevent the for loop in the first place assign an empty array
                    // in case there are no cookies at all.
                    var cookies = document.cookie ? document.cookie.split('; ') : [];
                    var i = 0;

                    for (; i < cookies.length; i++) {
                        var parts = cookies[i].split('=');
                        var cookie = parts.slice(1).join('=');

                        if (!json && cookie.charAt(0) === '"') {
                            cookie = cookie.slice(1, -1);
                        }

                        try {
                            var name = decode(parts[0]);
                            cookie = (converter.read || converter)(cookie, name) ||
                                decode(cookie);

                            if (json) {
                                try {
                                    cookie = JSON.parse(cookie);
                                } catch (e) { }
                            }

                            jar[name] = cookie;

                            if (key === name) {
                                break;
                            }
                        } catch (e) { }
                    }

                    return key ? jar[key] : jar;
                }

                api.set = set;
                api.get = function (key) {
                    return get(key, false /* read as raw */);
                };
                api.getJSON = function (key) {
                    return get(key, true /* read as json */);
                };
                api.remove = function (key, attributes) {
                    set(key, '', extend(attributes, {
                        expires: -1
                    }));
                };

                api.defaults = {};

                api.withConverter = init;

                return api;
            }

            return init(function () { });
        }));
    </script>
    <style type="text/css">
        .form {
            margin: 10px auto;
            max-width: 500px;
            padding: 20px 12px 10px 20px;
            font: 13px "Lucida Sans Unicode", "Lucida Grande", Arial, Helvetica, sans-serif;
        }

        .form li {
            padding: 0;
            display: block;
            list-style: none;
            margin: 10px 0 0 0;
        }

        .form label {
            margin: 0 0 3px 0;
            padding: 0px;
            display: block;
            font-weight: bold;
        }

        .form input[type=text],
        .form input[type=date],
        .form input[type=datetime],
        .form input[type=number],
        .form input[type=search],
        .form input[type=time],
        .form input[type=url],
        .form input[type=email],
        textarea,
        select {
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            background-color: white;
            border: 1px solid rgb(190, 190, 190);
            padding: 7px;
            margin: 0px;
            -webkit-transition: all 0.30s ease-in-out;
            -moz-transition: all 0.30s ease-in-out;
            -ms-transition: all 0.30s ease-in-out;
            -o-transition: all 0.30s ease-in-out;
            outline: none;
        }

        .form input[type=text]:focus,
        .form input[type=date]:focus,
        .form input[type=datetime]:focus,
        .form input[type=number]:focus,
        .form input[type=search]:focus,
        .form input[type=time]:focus,
        .form input[type=url]:focus,
        .form input[type=email]:focus,
        .form textarea:focus,
        .form select:focus {
            -moz-box-shadow: 0 0 8px #88D5E9;
            -webkit-box-shadow: 0 0 8px #88D5E9;
            box-shadow: 0 0 8px #88D5E9;
            border: 1px solid #88D5E9;
        }

        .form .field-divided {
            width: 49%;
        }

        .form .field-long {
            width: 100%;
        }

        .form .field-select {
            width: 100%;
        }

        .form .field-textarea {
            height: 100px;
        }

        .form input[type=submit],
        .form input[type=button] {
            background: #000000;
            padding: 8px 15px 8px 15px;
            border: none;
            color: #fff;
        }

        .form input[type=submit]:hover,
        .form input[type=button]:hover {
            background: #313131;
            box-shadow: none;
            -moz-box-shadow: none;
            -webkit-box-shadow: none;
        }

        .form .required {
            color: red;
        }
        .form .advanced {
            color: rgb(131, 131, 131);
        }
    </style>
    <script>
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        function cleanParameter(value) {
            if (value)
                return encodeURIComponent(value.replace(/( )/ig, "_").replace(/[^a-zA-Z0-9_]/g, "").toLowerCase());
        }
    </script>
</head>

<body>
    <script>
        
        function onSubmit(e) { 
            e.preventDefault();  
            document.getElementById("submitted").checked = true;           
            //Check errors
            if (document.getElementById("errors").innerHTML.length > 0) {
                document.getElementById("link").style.display = "none";
                document.getElementById("shorten").style.display = "none";
            } else {
                if (document.getElementById("submitted").checked) {                    
                    document.getElementById("shorten").style.display = "";
                }
            }
       
            
            //Build url
            document.getElementById("link").innerHTML = "";
            var url = document.getElementById("url").value;
            if (typeof url !== 'string' || url.length < 3) {
                document.getElementById("errors").innerHTML = "URL Required";
                return false;    
            }
            if (!/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/.test(url)) {
                document.getElementById("errors").innerHTML = "Bad URL";
                return false;    
            }
            var redirector = document.getElementById("redirector").value;
            if (typeof redirector !== 'string' || redirector.length < 3) {
                document.getElementById("errors").innerHTML = "Redirect Server Required";
                return false;    
            }

            document.getElementById("errors").innerHTML = "";
            var link = ''; 
            
            document.getElementById("link").innerHTML =  ""; //`&url=${encodeURIComponent(document.getElementById("url").value + (document.getElementById("hideqp").checked ? "" : "?gu=1" + link))}`;
            document.getElementById("link").href = link;

        }

        function onChangeRedirector() {
            let options = { expires: 99999 }
            if (!ipv4v6regex.test(window.location.hostname)) {
                const ha = window.location.hostname.split(".");            
                let dom = ha[ha.length - 1];
                if (ha.length > 1)
                    dom = ha[ha.length - 2] + "." + dom;       
                options.domain = dom;
            }
            Cookies.set('rdr', document.getElementById("redirector").value, options);          
        }
        var ipv4v6regex =  /(^\s*((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$)/;
        
        function onChangeUid() {
            let options = { expires: 99999 }
            Cookies.set('uid', document.getElementById("uid").value, options);
        }
        
        function onChangeKey() {
            let options = { expires: 99999 }
            Cookies.set('key', document.getElementById("key").value, options);
        }

    </script>
    <form onsubmit="return onSubmit(event);">
        <ul class="form">
            <li>
                <h3>Shorten a URL:</h3>
                <hr/>
                <p>Only letters, numbers and _ are accepted characters for all values except URL and the redirect server. These values will be auto-corrected.</small></p>
            </li>
            <li>
                <label>Redirect Server URL<span class="required">*</span></label>
                <input id="redirector" placeholder="Ex. tr.example.com" type="text" onchange="onChangeRedirector()" class="field-long"/>
            </li>  
            <li>
                <label>Shortened Path<span class="required">*</span></label>
                <input id="path" type="text" class="field-divided" placeholder="Ex. /tv"/>                
            </li>     
            <li>
                <label>Original Url<span class="required">*</span></label>
                <input id="url" type="text" class="field-long"/>
            </li>  
            <li>
                <h4 class="advanced">Admin Options:</h4>
                <hr/>
            </li>                             
            <li>
                <label class="advanced">Redirect Server User<span class="required">*</span></label>
                <input id="uid" type="text" onchange="onChangeUid()" class="field-long"/>
            </li>       
            <li>
                <label class="advanced">Redirect Server Key<span class="required">*</span></label>
                <input id="key" type="text" onchange="onChangeKey()" class="field-long"/>
            </li>                    
            <li>
                <input type="submit" value="Check" />
            </li>
            <li>
                    <input id="submitted" type="checkbox" style="display: none;"/>
                    <p id="errors" class="required"></p>
                    <p><a id="link" href="link" style="display: none;"></a></p>
                    <input id="shorten" type="button" style="display: none;" value="Confirm" />
            </li>
        </ul>
        <input id="ref" type="hidden" />
    </form>
    <script>
        document.getElementById("url").value = getParameterByName('url') || '';
        document.getElementById("redirector").value = Cookies.get('rdr') || '';
        document.getElementById("uid").value = Cookies.get('uid') || '';
        document.getElementById("key").value = Cookies.get('key') || '';
    </script>
</body>

</html>